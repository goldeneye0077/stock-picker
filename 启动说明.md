# 智能选股系统 - 启动指南

## 快速启动

### 方式一：使用启动脚本（推荐）

#### Windows 系统

**智能启动（自动检查）：**
```bash
start.bat
# 或
npm start
```

**简化启动（跳过检查）：**
```bash
start-simple.bat
```

**分窗口启动（独立日志）：**
```bash
start-manual.bat
```

#### Linux/macOS 系统
```bash
chmod +x start.sh
./start.sh
# 或
npm start
```

---

### 方式二：使用原有命令

并行启动所有服务：
```bash
npm run dev
```

单独启动某个服务：
```bash
npm run dev:frontend    # 前端服务 (端口 3001)
npm run dev:backend     # 后端服务 (端口 3000)
npm run dev:data-service # 数据服务 (端口 8001)
```

---

## 启动脚本功能

`start-services.js` 脚本提供了以下功能：

### 1. 环境检查
- ✓ 检查 Node.js 是否安装及版本
- ✓ 检查 npm 是否安装及版本
- ✓ 检查 Python 是否安装及版本

### 2. 依赖检查
- ✓ 检查前端依赖是否安装（`frontend/node_modules`）
- ✓ 检查后端依赖是否安装（`backend/node_modules`）
- ✓ 检查 Python 依赖（提示信息）
- ✓ 自动安装缺失的 Node 依赖

### 3. 数据库检查
- ✓ 检查 `data` 目录是否存在
- ✓ 检查数据库文件是否存在
- ✓ 自动创建缺失的目录

### 4. 端口检查
- ✓ 检查端口 3000、3001、8001 是否被占用
- ✓ 提示释放被占用的端口

### 5. 环境配置检查
- ✓ 检查 `.env` 配置文件是否存在
- ✓ 提示创建缺失的配置文件

### 6. 服务启动
- ✓ 按顺序启动后端、前端、数据服务
- ✓ 彩色日志输出，区分不同服务
- ✓ 实时显示服务日志

### 7. 访问信息展示
- ✓ 显示各服务的访问地址
- ✓ 提供停止服务的提示

---

## 服务访问地址

启动成功后，可以通过以下地址访问：

| 服务 | 地址 | 说明 |
|------|------|------|
| 📊 前端界面 | http://localhost:3001 | React Web 应用 |
| 🔌 后端 API | http://localhost:3000 | Express API 服务 |
| 📈 数据服务 | http://localhost:8001 | FastAPI 数据处理服务 |
| 📝 API 文档 | http://localhost:8001/docs | FastAPI 自动生成的文档 |

---

## 启动脚本说明

项目提供了三种 Windows 启动脚本：

| 脚本文件 | 说明 | 适用场景 |
|---------|------|---------|
| `start.bat` | 智能启动脚本，调用 `start-services.js` | 推荐使用，自动检查环境 |
| `start-simple.bat` | 简化启动脚本，直接使用 `npm run dev` | 如果智能脚本失败，使用此脚本 |
| `start-manual.bat` | 手动分步启动，打开三个独立窗口 | 需要查看各服务独立日志时使用 |

---

## 常见问题

### 0. 首次安装依赖

**首次运行前，建议手动安装所有依赖：**

```bash
# 方式1：一键安装所有依赖
npm run setup

# 方式2：分步安装
npm install                        # 根目录依赖
cd backend && npm install          # 后端依赖
cd ../frontend && npm install      # 前端依赖
cd ../data-service && pip install -r requirements.txt  # Python 依赖
```

### 1. spawn EINVAL 错误（Windows）

**错误信息：**
```
Error: spawn EINVAL
```

**解决方法：**

1. **使用简化启动脚本：**
   ```bash
   start-simple.bat
   ```

2. **或手动安装依赖后再启动：**
   ```bash
   npm run setup
   npm start
   ```

3. **或使用分窗口启动：**
   ```bash
   start-manual.bat
   ```

### 2. 端口被占用

**错误信息：**
```
✗ 端口 3000 已被占用！请关闭占用该端口的程序
```

**解决方法：**

#### Windows
```bash
# 查找占用端口的进程
netstat -ano | findstr :3000

# 结束进程（将 PID 替换为实际进程ID）
taskkill /PID <PID> /F
```

#### Linux/macOS
```bash
# 查找占用端口的进程
lsof -i :3000

# 结束进程
kill -9 <PID>
```

---

### 2. Python 依赖未安装

**错误信息：**
```
ModuleNotFoundError: No module named 'fastapi'
```

**解决方法：**
```bash
cd data-service
pip install -r requirements.txt
```

或使用国内镜像源加速：
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

### 3. Node 依赖未安装

**自动处理：** 启动脚本会自动检测并安装缺失的依赖

**手动安装：**
```bash
# 安装所有服务依赖
npm run setup

# 或分别安装
npm run install:all        # Node.js 依赖
npm run install:python     # Python 依赖
```

---

### 4. 数据库文件不存在

**自动处理：** 数据库文件会在首次启动时自动创建

**手动创建：** 可以运行数据管理脚本：
```bash
python check_data.py
```

---

### 5. 环境变量配置缺失

**后端配置文件：** `backend/.env`
```env
PORT=3000
FRONTEND_URL=http://localhost:3001
DATABASE_URL=sqlite:../data/stock_picker.db
```

**数据服务配置文件：** `data-service/.env`
```env
TUSHARE_TOKEN=your_tushare_token_here
```

> 从 https://tushare.pro/ 获取 Token

---

## 停止服务

在启动脚本运行的终端中按 **Ctrl + C** 即可停止所有服务。

脚本会自动清理所有子进程。

---

## 日志说明

启动脚本使用不同颜色区分各服务的日志：

- 🟦 **青色** - 后端服务日志
- 🟨 **黄色** - 前端服务日志
- 🟩 **绿色** - 数据服务日志

每条日志格式：
```
[服务名称] 日志内容
```

---

## 高级用法

### 仅启动特定服务

如果只需要启动某个服务，使用原有命令：

```bash
# 仅启动前端
npm run dev:frontend

# 仅启动后端
npm run dev:backend

# 仅启动数据服务
npm run dev:data-service
```

### 修改端口配置

如需修改端口，编辑 `start-services.js` 中的 `CONFIG` 对象：

```javascript
const CONFIG = {
  services: [
    {
      name: '后端服务',
      port: 3000,  // 修改此处
      // ...
    },
    // ...
  ]
};
```

---

## 生产环境部署

启动脚本适用于开发环境。生产环境部署请参考 `docker-compose.yml` 或使用：

```bash
# 构建所有服务
npm run build

# 启动生产版本
npm run start:prod  # 需要额外配置
```

---

## 技术栈

- **前端**：React 19 + TypeScript + Vite + Ant Design 5
- **后端**：Node.js + Express + TypeScript + SQLite
- **数据服务**：Python 3 + FastAPI + Tushare API

---

## 脚本源码

启动脚本源码位于：
- `start-services.js` - 主启动脚本（跨平台）
- `start.bat` - Windows 快速启动
- `start.sh` - Linux/macOS 快速启动

欢迎根据需要自定义修改！

---

## 获取帮助

遇到问题请查看：
1. 项目根目录的 `CLAUDE.md` - 完整项目说明
2. 各服务目录的 `README.md`
3. GitHub Issues（如有）

---

**祝您使用愉快！** 🚀
