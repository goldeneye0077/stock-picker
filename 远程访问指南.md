# 智能选股系统 - 远程访问指南 (安卓平板适用)

## ✅ 服务已启动

所有服务已成功在远程服务器上启动并配置为允许远程访问：

| 服务 | 端口 | 状态 | 监听地址 |
|------|------|------|---------|
| 前端 | 3001 | ✅ 运行中 | 0.0.0.0 |
| 后端API | 3000 | ✅ 运行中 | 0.0.0.0 |
| 数据服务 | 8001 | ✅ 运行中 | 0.0.0.0 |

**服务器内网地址**: `21.0.0.8`

---

## 📱 如何从安卓平板访问

### 方式一：使用 Claude Code 提供的访问链接（推荐）

如果您正在使用 Claude Code 的远程环境，通常会提供端口转发功能：

1. 查看 Claude Code 界面是否有"端口"或"Ports"选项卡
2. 找到端口 3001 对应的公网访问地址
3. 在平板浏览器中打开该地址

### 方式二：使用 VS Code 端口转发

如果您使用 VS Code Remote 连接：

1. 打开 VS Code 的"端口"面板
2. 添加端口转发：3000, 3001, 8001
3. 将转发的公网地址复制到平板浏览器

### 方式三：使用 ngrok（适用于任何环境）

如果服务器上没有内置端口转发，可以使用 ngrok：

```bash
# 安装 ngrok (如未安装)
# 下载地址: https://ngrok.com/download

# 启动前端隧道
ngrok http 3001
# 会得到类似 https://xxxx.ngrok.io 的公网地址

# 在另一个终端启动后端隧道
ngrok http 3000

# 在第三个终端启动数据服务隧道
ngrok http 8001
```

然后：
1. 将前端的 ngrok 地址在平板浏览器中打开
2. 注意：需要同时转发所有三个端口才能正常使用

---

## 🔧 已完成的配置更改

为了支持远程访问，已自动完成以下配置：

### 1. 前端配置 (frontend/)

**vite.config.ts**:
```typescript
server: {
  host: '0.0.0.0',  // 允许外部访问
  port: 3001,
  strictPort: true,
}
```

**src/config/api.ts**:
- 自动检测访问域名
- 本地访问时使用 localhost
- 远程访问时自动使用当前域名

### 2. 后端配置 (backend/)

**src/index.ts**:
```typescript
server.listen(3000, '0.0.0.0')  // 监听所有网络接口
app.use(cors({ origin: '*' }))   // 允许所有来源（调试用）
```

### 3. 数据服务配置 (data-service/)

```bash
python3 -m uvicorn src.main:app --host 0.0.0.0 --port 8001
```

---

## ⚠️ 重要提示

### 安全警告
当前配置为**开发/调试模式**，允许所有来源访问（CORS: *）。**不要在生产环境使用此配置！**

生产环境部署前需要：
1. 限制 CORS 允许的域名
2. 添加身份验证机制
3. 使用 HTTPS
4. 配置防火墙规则

### 数据库状态
- 当前数据库为空
- 需要导入数据才能看到股票信息
- 运行 `python create_sample_data.py` 创建示例数据

---

## 🔍 故障排查

### 1. 无法连接到服务器

**问题**: 平板浏览器显示"无法访问此网站"

**解决方案**:
- 确认服务器防火墙已开放端口 3000, 3001, 8001
- 检查网络环境是否允许访问这些端口
- 使用 ngrok 等隧道服务绕过防火墙限制

### 2. 前端加载但无法获取数据

**问题**: 页面显示但没有数据

**解决方案**:
- 检查浏览器控制台的错误信息
- 确认后端API（3000）和数据服务（8001）可访问
- 检查 CORS 配置是否正确

### 3. API 请求被拒绝

**问题**: 控制台显示 CORS 错误

**解决方案**:
- 后端已配置 `origin: '*'`，应该不会有此问题
- 如仍出现，检查是否有代理或VPN干扰

---

## 📊 服务健康检查

在平板浏览器中访问以下地址验证服务状态：

```
# 替换 <server-address> 为实际的服务器地址

# 后端健康检查
http://<server-address>:3000/health
# 应返回: {"status":"OK","timestamp":"..."}

# 数据服务健康检查
http://<server-address>:8001/health
# 应返回: {"status":"healthy","service":"data-service"}

# 数据服务API文档
http://<server-address>:8001/docs
# 显示 Swagger UI 文档

# 前端页面
http://<server-address>:3001
# 显示应用主界面
```

---

## 🚀 快速开始

1. **获取访问地址**
   - 向 Claude Code 询问端口 3001 的公网访问链接
   - 或使用 ngrok: `ngrok http 3001`

2. **在平板浏览器打开前端地址**
   - 例如: `http://xxxx.ngrok.io` 或 `http://your-server:3001`

3. **导入测试数据**（可选）
   ```bash
   python create_sample_data.py
   ```

4. **开始使用**
   - 刷新浏览器页面
   - 应该能看到股票列表和数据

---

## 💡 推荐的开发工作流

由于使用安卓平板：

1. **使用远程服务器运行后端服务**（当前方式）
2. **使用平板浏览器访问前端**
3. **使用浏览器开发者工具调试**
   - Chrome/Edge: 访问 `chrome://inspect`
   - Firefox: 在设置中启用远程调试

4. **代码修改**
   - 在平板上使用 Termux + Code-Server
   - 或在电脑上修改代码，远程服务器自动热重载

---

## 📞 需要帮助？

如果无法访问，请提供以下信息：

1. 您的访问方式（Claude Code / VS Code Remote / ngrok / 其他）
2. 浏览器控制台的错误信息
3. 网络环境（公司网络/家庭网络/移动网络）
4. 具体访问的URL

这样我们可以更好地帮您解决问题。
