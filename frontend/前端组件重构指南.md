# å‰ç«¯ç»„ä»¶é‡æ„æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†æ‹†åˆ†å¤§å‹å‰ç«¯ç»„ä»¶ï¼ˆAnalysis.tsx å’Œ StockList.tsxï¼‰çš„è¯¦ç»†æ–¹æ¡ˆã€‚è¿™æ˜¯ç¬¬2-3å‘¨æ¶æ„ä¼˜åŒ–ä»»åŠ¡çš„æ ¸å¿ƒå†…å®¹ã€‚

## ğŸ¯ é‡æ„ç›®æ ‡

1. **é™ä½ç»„ä»¶å¤æ‚åº¦** - å°†800+è¡Œçš„å·¨å‹ç»„ä»¶æ‹†åˆ†ä¸ºæ›´å°çš„ã€èŒè´£å•ä¸€çš„ç»„ä»¶
2. **æå‡ä»£ç å¤ç”¨æ€§** - é€šè¿‡è‡ªå®šä¹‰Hookså’ŒæœåŠ¡å±‚å®ç°é€»è¾‘å¤ç”¨
3. **æ”¹å–„å¯ç»´æŠ¤æ€§** - æ¸…æ™°çš„ç›®å½•ç»“æ„å’ŒèŒè´£åˆ†ç¦»
4. **ä¼˜åŒ–æ€§èƒ½** - å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

## ğŸ“ æ–°çš„ç›®å½•ç»“æ„

```
frontend/src/
â”œâ”€â”€ hooks/                    # è‡ªå®šä¹‰Hooksï¼ˆâœ… å·²åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ useApi.ts            # âœ… é€šç”¨APIè°ƒç”¨Hook
â”‚   â”œâ”€â”€ useFundFlow.ts       # âœ… èµ„é‡‘æµå‘Hook
â”‚   â”œâ”€â”€ useVolumeAnalysis.ts # â³ æˆäº¤é‡åˆ†æHookï¼ˆå¾…åˆ›å»ºï¼‰
â”‚   â””â”€â”€ useMainForce.ts      # â³ ä¸»åŠ›è¡Œä¸ºHookï¼ˆå¾…åˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ services/                 # APIæœåŠ¡å±‚ï¼ˆâœ… å·²åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ analysisService.ts   # âœ… åˆ†ææ•°æ®æœåŠ¡
â”‚   â””â”€â”€ stockService.ts      # â³ è‚¡ç¥¨æ•°æ®æœåŠ¡ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Analysis/            # â³ Analysisç»„ä»¶ç›®å½•ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚   â”‚   â”œâ”€â”€ FundFlowCard.tsx        # èµ„é‡‘æµå‘å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ VolumeAnalysisCard.tsx  # æˆäº¤é‡åˆ†æå¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ MainForceCard.tsx       # ä¸»åŠ›è¡Œä¸ºå¡ç‰‡
â”‚   â”‚   â””â”€â”€ FilterBar.tsx           # ç­›é€‰æ¡ä»¶ç»„ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ StockList/           # â³ StockListç»„ä»¶ç›®å½•ï¼ˆå¾…åˆ›å»ºï¼‰
â”‚       â”œâ”€â”€ StockTable.tsx          # è‚¡ç¥¨è¡¨æ ¼
â”‚       â”œâ”€â”€ StockSearchBar.tsx      # æœç´¢æ 
â”‚       â””â”€â”€ StockFilters.tsx        # ç­›é€‰å™¨
â”‚
â””â”€â”€ pages/
    â”œâ”€â”€ Analysis.tsx         # â³ é‡æ„åçš„ä¸»ç»„ä»¶ï¼ˆå¾…æ›´æ–°ï¼‰
    â””â”€â”€ StockList.tsx        # â³ é‡æ„åçš„ä¸»ç»„ä»¶ï¼ˆå¾…æ›´æ–°ï¼‰
```

## ğŸ”§ å·²å®Œæˆçš„åŸºç¡€å·¥ä½œ

### 1. âœ… é€šç”¨API Hook (`useApi.ts`)

æä¾›ç»Ÿä¸€çš„ï¼š
- åŠ è½½çŠ¶æ€ç®¡ç†
- é”™è¯¯å¤„ç†
- æˆåŠŸ/å¤±è´¥å›è°ƒ
- æ•°æ®é‡ç½®åŠŸèƒ½

```typescript
const { data, loading, execute, reset } = useApi(fetchSomeData, {
  successMessage: 'æ•°æ®åŠ è½½æˆåŠŸ',
  errorMessage: 'æ•°æ®åŠ è½½å¤±è´¥'
});
```

### 2. âœ… åˆ†ææ•°æ®æœåŠ¡å±‚ (`analysisService.ts`)

å°è£…äº†ä¸‰ä¸ªæ ¸å¿ƒAPIï¼š
- `fetchFundFlowData()` - èµ„é‡‘æµå‘
- `fetchVolumeAnalysisData()` - æˆäº¤é‡åˆ†æ
- `fetchMainForceData()` - ä¸»åŠ›è¡Œä¸ºåˆ†æ

### 3. âœ… èµ„é‡‘æµå‘Hook (`useFundFlow.ts`)

æä¾›ï¼š
- æ•°æ®è‡ªåŠ¨è·å–å’Œè½¬æ¢
- å‚æ•°ç®¡ç†ï¼ˆæ›´æ–°/é‡ç½®ï¼‰
- åŠ è½½çŠ¶æ€
- æ ¼å¼åŒ–çš„å±•ç¤ºæ•°æ®

## ğŸ“ åç»­æ‹†åˆ†æ­¥éª¤

### æ­¥éª¤1: åˆ›å»ºå‰©ä½™çš„Hooks

#### `useVolumeAnalysis.ts`
```typescript
export function useVolumeAnalysis(initialParams: VolumeAnalysisParams = {}) {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(false);
  const [params, setParams] = useState(initialParams);

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      const result = await fetchVolumeAnalysisData(params);
      setData(result.volumeSurges || []);
      message.success('æˆäº¤é‡æ•°æ®å·²åˆ·æ–°');
    } catch (error) {
      message.error('è·å–æˆäº¤é‡æ•°æ®å¤±è´¥');
      setData([]);
    } finally {
      setLoading(false);
    }
  }, [params]);

  const updateParams = useCallback((newParams) => {
    setParams(prev => ({ ...prev, ...newParams }));
  }, []);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return { data, loading, params, fetchData, updateParams };
}
```

#### `useMainForce.ts`
```typescript
export function useMainForce(initialParams: MainForceParams = {}) {
  const [data, setData] = useState([]);
  const [summary, setSummary] = useState(null);
  const [loading, setLoading] = useState(false);
  const [params, setParams] = useState(initialParams);

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      const result = await fetchMainForceData(params);
      setData(result.mainForce || []);
      setSummary(result.summary || null);
      message.success('ä¸»åŠ›è¡Œä¸ºæ•°æ®å·²åˆ·æ–°');
    } catch (error) {
      message.error('è·å–ä¸»åŠ›è¡Œä¸ºæ•°æ®å¤±è´¥');
      setData([]);
      setSummary(null);
    } finally {
      setLoading(false);
    }
  }, [params]);

  const updateParams = useCallback((newParams) => {
    setParams(prev => ({ ...prev, ...newParams }));
  }, []);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return { data, summary, loading, params, fetchData, updateParams };
}
```

### æ­¥éª¤2: åˆ›å»ºå­ç»„ä»¶

#### `FundFlowCard.tsx` - èµ„é‡‘æµå‘å¡ç‰‡ç»„ä»¶
```typescript
import React from 'react';
import { Card, List, Progress, Space, Button, Typography } from 'antd';
import { FundOutlined, SyncOutlined } from '@ant-design/icons';
import { useFundFlow } from '../../hooks/useFundFlow';

const { Title } = Typography;

export const FundFlowCard: React.FC = () => {
  const { data, loading, fetchData } = useFundFlow({ days: 30 });

  return (
    <Card
      title={
        <Space>
          <FundOutlined />
          <Title level={5} style={{ margin: 0 }}>èµ„é‡‘æµå‘åˆ†æ</Title>
        </Space>
      }
      extra={
        <Button
          size="small"
          icon={<SyncOutlined spin={loading} />}
          onClick={fetchData}
          loading={loading}
        >
          åˆ·æ–°
        </Button>
      }
    >
      <List
        dataSource={data}
        renderItem={(item) => (
          <List.Item>
            <div style={{ width: '100%' }}>
              <div style={{ marginBottom: 8 }}>
                {item.type}: {item.amount}
              </div>
              <Progress
                percent={item.percent}
                strokeColor={item.color}
                showInfo={false}
              />
            </div>
          </List.Item>
        )}
      />
    </Card>
  );
};
```

#### `VolumeAnalysisCard.tsx` - æˆäº¤é‡å¼‚åŠ¨å¡ç‰‡ç»„ä»¶
```typescript
import React from 'react';
import { Card, List, Tag, Space, Button } from 'antd';
import { FireOutlined, SyncOutlined } from '@ant-design/icons';
import { useVolumeAnalysis } from '../../hooks/useVolumeAnalysis';
import { FilterBar } from './FilterBar';

export const VolumeAnalysisCard: React.FC = () => {
  const { data, loading, params, fetchData, updateParams } = useVolumeAnalysis();

  return (
    <Card
      title={<Space><FireOutlined /> æˆäº¤é‡å¼‚åŠ¨åˆ†æ</Space>}
      extra={
        <Button
          size="small"
          icon={<SyncOutlined spin={loading} />}
          onClick={fetchData}
          loading={loading}
        >
          åˆ·æ–°
        </Button>
      }
    >
      <FilterBar params={params} onUpdate={updateParams} />

      <List
        loading={loading}
        dataSource={data}
        renderItem={(item: any) => (
          <List.Item>
            <List.Item.Meta
              title={`${item.stock} ${item.name}`}
              description={
                <Space>
                  <Tag color="red">é‡æ¯”: {item.volumeRatio?.toFixed(2)}</Tag>
                  <Tag color="blue">æ¶¨å¹…: {item.changePercent?.toFixed(2)}%</Tag>
                </Space>
              }
            />
          </List.Item>
        )}
      />
    </Card>
  );
};
```

#### `MainForceCard.tsx` - ä¸»åŠ›è¡Œä¸ºå¡ç‰‡ç»„ä»¶
```typescript
import React from 'react';
import { Card, Table, Space, Button, Statistic, Row, Col } from 'antd';
import { TrophyOutlined, SyncOutlined } from '@ant-design/icons';
import { useMainForce } from '../../hooks/useMainForce';

export const MainForceCard: React.FC = () => {
  const { data, summary, loading, fetchData } = useMainForce({ days: 7, limit: 20 });

  const columns = [
    {
      title: 'è‚¡ç¥¨',
      dataIndex: 'stock',
      key: 'stock',
      render: (text: string, record: any) => `${text} ${record.name}`
    },
    {
      title: 'ä¸»åŠ›è¡Œä¸º',
      dataIndex: 'behavior',
      key: 'behavior'
    },
    {
      title: 'èµ„é‡‘å¼ºåº¦',
      dataIndex: 'strength',
      key: 'strength',
      render: (val: number) => `${val.toFixed(2)}äº¿`
    },
    {
      title: 'è¶‹åŠ¿',
      dataIndex: 'trend',
      key: 'trend'
    }
  ];

  return (
    <Card
      title={<Space><TrophyOutlined /> ä¸»åŠ›è¡Œä¸ºåˆ†æ</Space>}
      extra={
        <Button
          size="small"
          icon={<SyncOutlined spin={loading} />}
          onClick={fetchData}
          loading={loading}
        >
          åˆ·æ–°
        </Button>
      }
    >
      {summary && (
        <Row gutter={16} style={{ marginBottom: 16 }}>
          <Col span={6}>
            <Statistic title="å¼ºåŠ¿ä»‹å…¥" value={summary.strongCount} />
          </Col>
          <Col span={6}>
            <Statistic title="ç¨³æ­¥å»ºä»“" value={summary.moderateCount} />
          </Col>
          <Col span={6}>
            <Statistic title="å°å¹…æµå…¥" value={summary.weakCount} />
          </Col>
          <Col span={6}>
            <Statistic title="å¹³å‡å¼ºåº¦" value={summary.avgStrength} suffix="äº¿" />
          </Col>
        </Row>
      )}

      <Table
        loading={loading}
        columns={columns}
        dataSource={data}
        rowKey="stock"
        pagination={{ pageSize: 10 }}
      />
    </Card>
  );
};
```

### æ­¥éª¤3: é‡æ„ä¸»ç»„ä»¶ `Analysis.tsx`

```typescript
import React from 'react';
import { Row, Col } from 'antd';
import { FundFlowCard } from '../components/Analysis/FundFlowCard';
import { VolumeAnalysisCard } from '../components/Analysis/VolumeAnalysisCard';
import { MainForceCard } from '../components/Analysis/MainForceCard';

const Analysis: React.FC = () => {
  return (
    <div style={{ padding: '24px' }}>
      <Row gutter={[16, 16]}>
        <Col span={24}>
          <FundFlowCard />
        </Col>

        <Col span={24}>
          <VolumeAnalysisCard />
        </Col>

        <Col span={24}>
          <MainForceCard />
        </Col>
      </Row>
    </div>
  );
};

export default Analysis;
```

### æ­¥éª¤4: æ‹†åˆ† StockList.tsx

ç±»ä¼¼çš„æ–¹å¼æ‹†åˆ†StockListç»„ä»¶ï¼š

1. åˆ›å»º `stockService.ts` æœåŠ¡å±‚
2. åˆ›å»º `useStockList.ts` Hook
3. åˆ›å»ºå­ç»„ä»¶ï¼š
   - `StockTable.tsx` - è‚¡ç¥¨è¡¨æ ¼
   - `StockSearchBar.tsx` - æœç´¢æ 
   - `StockFilters.tsx` - ç­›é€‰å™¨
   - `StockDetailDrawer.tsx` - è¯¦æƒ…æŠ½å±‰

## âœ… é‡æ„æ•ˆæœ

### ä»£ç æŒ‡æ ‡æ”¹å–„
- **Analysis.tsx**: 842è¡Œ â†’ ~50è¡Œ (å‡å°‘94%)
- **StockList.tsx**: 783è¡Œ â†’ ~80è¡Œ (å‡å°‘90%)
- **ç»„ä»¶å¤ç”¨**: å¤šä¸ªé¡µé¢å¯å…±äº«å­ç»„ä»¶å’ŒHooks
- **å¯æµ‹è¯•æ€§**: æ¯ä¸ªHookå’Œç»„ä»¶å¯ç‹¬ç«‹æµ‹è¯•

### ç»´æŠ¤æ€§æå‡
- èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£
- ä¿®æ”¹å½±å“èŒƒå›´å°
- æ–°åŠŸèƒ½æ˜“äºæ·»åŠ 
- Bugå®šä½æ›´å¿«

## ğŸš€ å®æ–½å»ºè®®

1. **é€æ­¥é‡æ„** - ä¸è¦ä¸€æ¬¡æ€§å…¨éƒ¨é‡æ„ï¼Œå…ˆå®Œæˆä¸€ä¸ªæ¨¡å—å†è¿›è¡Œä¸‹ä¸€ä¸ª
2. **ä¿æŒå‘åå…¼å®¹** - é‡æ„æœŸé—´ç¡®ä¿ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
3. **ç¼–å†™æµ‹è¯•** - ä¸ºæ–°åˆ›å»ºçš„Hookså’Œç»„ä»¶æ·»åŠ æµ‹è¯•
4. **ä»£ç å®¡æŸ¥** - æ¯ä¸ªå­ç»„ä»¶å®Œæˆåè¿›è¡Œä»£ç å®¡æŸ¥

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **TypeScriptç±»å‹** - ç¡®ä¿æ‰€æœ‰Hookå’Œç»„ä»¶éƒ½æœ‰å®Œæ•´çš„ç±»å‹å®šä¹‰
2. **é”™è¯¯è¾¹ç•Œ** - è€ƒè™‘åœ¨å¡ç‰‡ç»„ä»¶å¤–åŒ…è£¹ErrorBoundary
3. **æ€§èƒ½ä¼˜åŒ–** - ä½¿ç”¨React.memoå’ŒuseCallbacké¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
4. **ç”¨æˆ·ä½“éªŒ** - ç¡®ä¿åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤ºç”¨æˆ·å‹å¥½

## ğŸ“š å‚è€ƒèµ„æº

- [React Hooks å®˜æ–¹æ–‡æ¡£](https://react.dev/reference/react)
- [Ant Design ç»„ä»¶åº“](https://ant.design/components/overview-cn/)
- [TypeScript æœ€ä½³å®è·µ](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)

---

**çŠ¶æ€**: åŸºç¡€è®¾æ–½å·²å®Œæˆï¼Œå¾…ç»§ç»­æ‹†åˆ†å­ç»„ä»¶
**è´Ÿè´£äºº**: å‰ç«¯å¼€å‘å›¢é˜Ÿ
**é¢„è®¡å®Œæˆæ—¶é—´**: ç¬¬2-3å‘¨
